<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Earn Tokens</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <h2>🎯 Watch Ad to Earn Tokens</h2>

  <p id="status">Waiting...</p>
  <button id="claimBtn" disabled>✅ Claim 5 Tokens</button>

  <script>
    const tg = window.Telegram.WebApp;
    const userId = tg.initDataUnsafe?.user?.id;

    tg.ready(); // 通知 Telegram Mini App 已準備好

    // 模擬廣告結束後顯示按鈕
    setTimeout(() => {
      document.getElementById('status').innerText = "⏳ Ad complete!";
      document.getElementById('claimBtn').disabled = false;
    }, 15000); // 15 秒廣告時間

    document.getElementById('claimBtn').addEventListener('click', async () => {
      const res = await fetch('/reward', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id: userId })
      });

      const result = await res.json();
      if (result.success) {
        document.getElementById('status').innerText = "✅ Tokens Sent!";
        tg.close(); // 可選：完成後自動關閉 Web App
      } else {
        document.getElementById('status').innerText = "❌ Error sending tokens.";
      }
    });
  </script>
</body>
</html>
